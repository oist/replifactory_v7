import{m as O,b as Q,u as N}from"./vuex.esm-bundler-CuEAE9ua.js";import{CFormSelect as q,CButton as z,CFormLabel as R,CForm as T,CCol as U,CSpinner as W,CAlert as G}from"./index.es-fMuEa2gX.js";import{a as H}from"./index-BWIQLakd.js";import{a as u,b as c,c as h,q as r,t as l,v as _,F as V,z as j,A as m,e as y,B as x,d as t,r as D,j as I,C as P,D as J,u as A}from"./index-Cu3QcvOp.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as B}from"./index.es-DYZfjILo.js";import{u as K}from"./index-BBkL1TfT.js";import{BModal as X}from"./bootstrap-vue-next-C5hh3FLc.js";const Y={components:{CFormSelect:q,CButton:z,CFormLabel:R,CForm:T,CCol:U,CSpinner:W,CAlert:G},data(){return{selectedMachine:void 0,loading:!1,error:"",showAlert:!1}},computed:{connectionOptions(){let e={},n=this.$store.state.machine.connection.options;return this.isConnected&&this.currentConnection!==void 0&&!(this.currentConnection.id in e)?(e[this.currentConnection.id]=this.currentConnection,{...n,devices:e}):n},...O("machine",{currentConnection:e=>e.connection.current,machineState:e=>e.machineState}),...Q("machine",["isDisconnected","isConnected"])},watch:{connectionOptions(e){const n=e.devices;if(this.isDisconnected&&!(this.selectedMachine in n)){const[f]=Object.keys(n);this.selectedMachine=f}},currentConnection(e){e!=null&&(this.selectedMachine=e.id)}},mounted(){this.refreshConnectionOptions(),this.selectedMachine=this.currentConnection.id},methods:{async disconnectMachine(){await this.connectCommand({command:"disconnect"})},async connectMachine(){await this.connectCommand({command:"connect",device_id:this.selectedMachine})},async connectCommand(e){this.loading=!0,this.showAlert=!1;try{const n=await H.post("/api/connection",e);console.log("Connection response: "+n),this.loading=!1}catch(n){this.error=n.response.data,this.showAlert=!0,this.loading=!1}},refreshConnectionOptions(){this.loading=!0,this.showAlert=!1,this.$store.dispatch("machine/updateConnection").then(e=>{if(this.loading=!1,e.current.id!=null)this.selectedMachine=e.current.id;else{const[n]=Object.keys(e.options.devices);this.selectedMachine=n}}).catch(e=>{this.loading=!1,this.error=e.response.data,this.showAlert=!0})},onDismissed(){}},sockets:{changeMachineListEvent(){}}},Z={class:"connection-setup"},ee=["value"];function te(e,n,f,C,s,a){const v=u("CFormLabel"),g=u("CFormSelect"),b=u("CCol"),S=u("CSpinner"),M=u("CButton"),$=u("CAlert"),E=u("CForm");return c(),h("div",Z,[r(E,{class:"row g-3"},{default:l(()=>[r(b,{xs:"12"},{default:l(()=>[r(v,{for:"machineSelect"},{default:l(()=>[_(" Machine ")]),_:1}),r(g,{id:"machineSelect",modelValue:s.selectedMachine,"onUpdate:modelValue":n[0]||(n[0]=i=>s.selectedMachine=i),"aria-label":"Select machine",disabled:e.isConnected},{default:l(()=>[(c(!0),h(V,null,j(a.connectionOptions.devices,(i,d)=>(c(),h("option",{key:d,value:d},m(i.product)+" ("+m(i.serial_number)+") ",9,ee))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),r(b,{xs:"12"},{default:l(()=>[e.isDisconnected?(c(),y(M,{key:0,disabled:s.loading,type:"button",color:"primary",variant:"outline",class:"w-100",onClick:a.connectMachine},{default:l(()=>[s.loading?(c(),y(S,{key:0,size:"sm",color:"secondary"})):x("",!0),_(" Connect ")]),_:1},8,["disabled","onClick"])):(c(),y(M,{key:1,disabled:s.loading,type:"button",color:"danger",variant:"outline",class:"w-100",onClick:a.disconnectMachine},{default:l(()=>[s.loading?(c(),y(S,{key:0,size:"sm",color:"secondary"})):x("",!0),_(" Disconnect ")]),_:1},8,["disabled","onClick"]))]),_:1}),s.error?(c(),y($,{key:0,modelValue:s.showAlert,"onUpdate:modelValue":n[1]||(n[1]=i=>s.showAlert=i),color:"danger",onDismissed:a.onDismissed},{default:l(()=>[_(m(s.error),1)]),_:1},8,["modelValue","onDismissed"])):x("",!0)]),_:1})])}const ne=F(Y,[["render",te]]),oe={components:{CButton:z,CIcon:B},computed:{...O("machine",{state_string:e=>e.data.state.text,sendQueue:e=>e.queue.send,commandQueue:e=>e.queue.command}),...Q("machine",{deviceControlEnabled:"isManualControlEnabled"})},methods:{handleCleanCommandQueueClick(){this.$store.dispatch("machine/runCommand",{device:"command_queue",command:"clear"}).then(e=>{console.debug(e)}).catch(e=>{this.$store.dispatch("notifyWarning",{content:e.response.data})})}}},se={class:"MachineState"},ce={class:"row"},ie=t("dt",null,"State",-1),ae=t("dt",null,"Queue",-1),le=t("br",null,null,-1);function re(e,n,f,C,s,a){return c(),h("div",se,[t("dl",ce,[ie,t("dd",null,m(e.state_string),1),ae,t("dd",null,[_(" Send: "+m(e.sendQueue.size?e.sendQueue.size:"0"),1),le,_(" Commands: "+m(e.commandQueue.size?e.commandQueue.size:"0"),1)])])])}const de=F(oe,[["render",re]]),ue={key:0,class:"list-group"},me={class:"d-flex w-100 justify-content-between"},he={class:"mb-1"},pe={class:"mb-1"},_e={class:"d-flex flex-column justify-content-start"},fe={class:"text-end"},Ce={key:0,class:"btn-group",role:"group","aria-label":"Basic example"},ve=["onClick"],be={class:"text-end my-2"},ge=t("h5",{class:"modal-title"},"Stop Experiment",-1),ye=["onClick"],xe=t("div",null,"Are you sure you want to stop the experiment?",-1),Se={__name:"ExperimentsStatuses",setup(e){const n=N(),f=K(),C=D(null),s=D(null),a=D(!1),v=I(()=>n.state.experiment.experiments),g=I(()=>Object.keys(v.value).length>0);P(()=>{C.value=setInterval(()=>{},5e3),n.dispatch("experiment/getExperiments")}),J(()=>{C.value&&clearInterval(C.value)});function b(){f.push({name:"NewExperiment"})}function S(i){const d=new Date(i),o=Math.floor((new Date-d)/1e3),p=Math.floor(o/3600),w=Math.floor(o%3600/60),L=o%60;return`${p}h ${w}m ${L}s ago`}const M=i=>{s.value=i,a.value=!0};function $(){E(s.value,"stop",{}),a.value=!1}function E(i,d,k){const o={experimentId:i,command:d,...k};n.dispatch("experiment/experimentCommand",o).catch(p=>{const w=p.response.data.error||p.response.data;n.dispatch("notifyWarning",{content:w})})}return(i,d)=>{const k=u("router-link");return c(),h(V,null,[g.value?(c(),h("div",ue,[(c(!0),h(V,null,j(v.value,(o,p)=>(c(),h("div",{key:p,class:"list-group-item"},[t("div",me,[t("div",null,[t("h5",he,[r(k,{to:{name:"ExperimentDetail",params:{id:p}},class:"text-decoration-none"},{default:l(()=>[_(m(o.name),1)]),_:2},1032,["to"])]),t("p",pe,m(o.status),1),t("small",null,"Cycles: "+m(o.cycles)+" next every "+m(o.cycleTime)+" seconds.",1)]),t("div",_e,[t("div",null,[t("small",null,m(S(o.startTime)),1)]),t("div",fe,[o.alive?(c(),h("div",Ce,[t("button",{class:"btn btn-danger",onClick:w=>M(p)},[r(A(B),{icon:"cilMediaStop"})],8,ve)])):x("",!0)])])])]))),128))])):x("",!0),t("div",be,[t("button",{class:"btn btn-success",onClick:b},[r(A(B),{icon:"cilPlus"}),_(" Run new experiment ")])]),r(A(X),{id:"stopModal",modelValue:a.value,"onUpdate:modelValue":d[1]||(d[1]=o=>a.value=o),title:"Stop Experiment"},{"modal-header":l(({close:o})=>[ge,t("button",{type:"button",class:"btn-close",onClick:o},null,8,ye)]),footer:l(()=>[t("button",{type:"button",class:"btn btn-secondary",onClick:d[0]||(d[0]=o=>a.value=!1)}," Leave "),t("button",{type:"button",class:"btn btn-danger",onClick:$}," Stop ")]),default:l(()=>[xe]),_:1},8,["modelValue"])],64)}}},Me={components:{MachineConnection:ne,MachineState:de,ExperimentsStatuses:Se}},ke={class:"container d-flex align-items-stretch"},we={class:"row align-items-stretch flex-fill bg-body"},$e={class:"col-md-3 p-3 border-end"},Ee=t("h4",null,"Connection",-1),De=t("h4",{class:"mt-3"},"Machine State",-1),Ae={class:"col-md-9 p-3"},Ve=t("h4",null,"Running experiments",-1);function Be(e,n,f,C,s,a){const v=u("MachineConnection"),g=u("MachineState"),b=u("ExperimentsStatuses");return c(),h("div",ke,[t("div",we,[t("div",$e,[Ee,r(v),De,r(g)]),t("div",Ae,[Ve,r(b)])])])}const qe=F(Me,[["render",Be]]);export{qe as default};
//# sourceMappingURL=HomeSection-Ccla1riB.js.map

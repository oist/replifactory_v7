{"version":3,"file":"plugins-B_Y7fZCS.js","sources":["../../../vue/src/plugins.js"],"sourcesContent":["import * as Vue from \"vue\";\nwindow.Vue = Vue;\n\nexport async function fetchPlugins() {\n  const response = await fetch(\"/api/plugins\");\n  return response.json();\n}\n\nexport async function loadPlugins(app) {\n  const plugins = await fetchPlugins();\n  for (const plugin of plugins) {\n    try {\n      if (plugin.frontend_modules && Array.isArray(plugin.frontend_modules)) {\n        for (const moduleInfo of plugin.frontend_modules) {\n          // Assuming moduleInfo.url contains the URL to the module\n          //   const module = await import(/* @vite-ignore */ moduleInfo.url);\n          const asyncComponent = Vue.defineAsyncComponent(\n            () => import(/* @vite-ignore */ moduleInfo.url),\n          );\n          app.component(plugin.name, asyncComponent);\n          //   app.provide(plugin.name, module)\n          //   if (module.default) {\n          //     // Assuming the component is exported as default\n          //     app.component(plugin.name, module.default);\n          //   } else {\n          // console.error(\n          //       `Module ${moduleInfo.url} does not have a default export.`,\n          //     );\n          //   }\n          //   if (typeof module.default === \"function\") {\n          //     // Pass the Vue app instance to the imported module if it exports a function\n          //     module.default(app);\n          //   } else {\n          //     // Use the module directly if it's not a function (e.g., a Vue plugin)\n          //     app.use(module.default);\n          //   }\n        }\n      }\n    } catch (e) {\n      console.error(`Error loading plugin ${plugin.name}: ${e}`);\n    }\n  }\n}\n\nexport async function externalComponent(url) {\n  let name;\n  try {\n    // const match = url.match(/\\/plugins\\/([^/]+)\\/([^/]+)\\.umd\\..*\\.?js$/);\n    // if (!match) {\n    //   throw new Error(\"Failed to extract pluginId and fileName from URL\");\n    // }\n\n    // const pluginId = match[1];\n    // const fileName = match[2];\n    // name = `${pluginId}-${fileName}`;\n\n    name = url\n      .split(\"/\")\n      .reverse()[0]\n      .match(/^(.*?)\\.umd/)[1];\n    if (!name) {\n      throw new Error(\"Failed to extract module name from URL\");\n    }\n  } catch (e) {\n    return Promise.reject(new Error(`Error parsing URL: ${url} ${e.message}`));\n  }\n\n  //   // Check if the module is already loaded or being loaded\n  if (window[name]) {\n    // If it's a promise, return it directly to avoid creating a new promise\n    if (window[name] instanceof Promise) {\n      return window[name];\n    }\n    // If the module is already loaded, wrap it in a resolved promise\n    return Promise.resolve(window[name]);\n  }\n  //   if (window[name]) return window[name];\n\n  // Create a new promise for loading the module\n  window[name] = new Promise((resolve, reject) => {\n    const script = document.createElement(\"script\");\n    script.async = true;\n    script.addEventListener(\"load\", () => {\n      // Ensure the script is loaded by checking if the module is defined\n      if (window[name]) {\n        resolve(window[name]);\n      } else {\n        reject(new Error(`Module ${name} did not load correctly.`));\n      }\n    });\n    script.addEventListener(\"error\", () => {\n      reject(new Error(`Error loading ${url}`));\n    });\n    script.src = url;\n    document.head.appendChild(script);\n  });\n\n  return window[name];\n}\n\nexport function componentLoader(url) {\n  return async () => {\n    if (!url) {\n      return {\n        template: `<p>URL is not provided</p>`,\n      };\n    }\n    try {\n      return await externalComponent(url);\n    } catch (error) {\n      console.error(error);\n      return {\n        template: `<p>${error.message}</p>`,\n      };\n    }\n  };\n}\n"],"names":["Vue","externalComponent","url","name","e","resolve","reject","script","componentLoader","error"],"mappings":"yCACA,OAAO,IAAMA,EA2CN,eAAeC,EAAkBC,EAAK,CAC3C,IAAIC,EACJ,GAAI,CAcF,GAJAA,EAAOD,EACJ,MAAM,GAAG,EACT,QAAO,EAAG,CAAC,EACX,MAAM,aAAa,EAAE,CAAC,EACrB,CAACC,EACH,MAAM,IAAI,MAAM,wCAAwC,CAE3D,OAAQC,EAAG,CACV,OAAO,QAAQ,OAAO,IAAI,MAAM,sBAAsBF,CAAG,IAAIE,EAAE,OAAO,EAAE,CAAC,CAC1E,CAGD,OAAI,OAAOD,CAAI,EAET,OAAOA,CAAI,YAAa,QACnB,OAAOA,CAAI,EAGb,QAAQ,QAAQ,OAAOA,CAAI,CAAC,GAKrC,OAAOA,CAAI,EAAI,IAAI,QAAQ,CAACE,EAASC,IAAW,CAC9C,MAAMC,EAAS,SAAS,cAAc,QAAQ,EAC9CA,EAAO,MAAQ,GACfA,EAAO,iBAAiB,OAAQ,IAAM,CAEhC,OAAOJ,CAAI,EACbE,EAAQ,OAAOF,CAAI,CAAC,EAEpBG,EAAO,IAAI,MAAM,UAAUH,CAAI,0BAA0B,CAAC,CAElE,CAAK,EACDI,EAAO,iBAAiB,QAAS,IAAM,CACrCD,EAAO,IAAI,MAAM,iBAAiBJ,CAAG,EAAE,CAAC,CAC9C,CAAK,EACDK,EAAO,IAAML,EACb,SAAS,KAAK,YAAYK,CAAM,CACpC,CAAG,EAEM,OAAOJ,CAAI,EACpB,CAEO,SAASK,EAAgBN,EAAK,CACnC,MAAO,UAAY,CACjB,GAAI,CAACA,EACH,MAAO,CACL,SAAU,4BAClB,EAEI,GAAI,CACF,OAAO,MAAMD,EAAkBC,CAAG,CACnC,OAAQO,EAAO,CACd,eAAQ,MAAMA,CAAK,EACZ,CACL,SAAU,MAAMA,EAAM,OAAO,MACrC,CACK,CACL,CACA"}